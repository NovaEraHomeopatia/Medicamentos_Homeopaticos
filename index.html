<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consulta de Medicamentos | Nova Era</title>

  <!-- DataTables + jQuery (CDN) -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

  <!-- PapaParse para ler CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.4;
    }
    h1 { margin-bottom: 6px; }
    .topo { margin-bottom: 10px; color: #444; }
    .loading { margin: 12px 0; }
    .erro { color: #b00020; font-weight: bold; margin: 12px 0; }
    .dica {
      margin: 10px 0 16px;
      padding: 10px;
      background: #f6f7f9;
      border: 1px solid #e3e6ea;
      border-radius: 8px;
      color: #333;
    }
    table.dataTable thead th { white-space: nowrap; }

    /* Opcional: deixa a 1ª coluna (Medicamento) um pouco mais “forte” visualmente */
    #tabela td.col-medicamento { font-weight: 600; }

    .rodape {
      margin-top: 14px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>

<body>
  <h1>Consulta de Medicamentos</h1>

  <div class="topo">
    Para consultar, digite o nome do <b>medicamento</b> na busca abaixo (ex.: <b>Arnica</b>, <b>Belladonna</b>, <b>Ignatia</b>).
  </div>

  <div class="dica">
    <b>Dicas rápidas:</b>
    <ul style="margin: 8px 0 0 18px;">
      <li>Você pode digitar só parte do nome (ex.: <b>arnica</b>).</li>
      <li>Para ver mais resultados de uma vez, use “Mostrar” e selecione <b>100</b>.</li>
      <li>As colunas <b>Escala</b> e <b>Potências disponíveis</b> são apenas informativas.</li>
    </ul>
  </div>

  <div id="status" class="loading">Carregando dados...</div>

  <table id="tabela" class="display" style="width:100%">
    <thead></thead>
    <tbody></tbody>
  </table>

  <div class="rodape">
    Se a lista for atualizada, basta substituir o arquivo <b>dados.csv</b> no repositório.
  </div>

  <script>
    // Nome do CSV (deve estar na mesma pasta do index.html no GitHub)
    const ARQUIVO_CSV = "dados.csv";

    // Seu CSV usa ponto e vírgula (confirmado no Bloco de Notas)
    const DELIMITADOR = ";";

    // Cabeçalho padrão (3 colunas)
    const CABECALHO_PADRAO = ["Medicamento", "Escala", "Potências disponíveis"];

    // Normaliza a coluna de potências para ficar mais “limpa”
    function normalizarPotencias(txt) {
      const s = (txt ?? "").toString();
      return s.replace(/\s+/g, " ").trim();
    }

    function montarTabela(cabecalho, linhas) {
      // Cabeçalho
      const thead = document.querySelector("#tabela thead");
      const trHead = document.createElement("tr");
      cabecalho.forEach(col => {
        const th = document.createElement("th");
        th.textContent = col || "";
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);

      // Corpo
      const tbody = document.querySelector("#tabela tbody");

      linhas.forEach(linha => {
        // ignora linhas completamente vazias
        const temConteudo = linha.some(c => String(c ?? "").trim() !== "");
        if (!temConteudo) return;

        const tr = document.createElement("tr");

        // 3 colunas: Medicamento | Escala | Potências
        const medicamento = (linha[0] ?? "").toString();
        const escala = (linha[1] ?? "").toString();
        const potencias = normalizarPotencias(linha[2] ?? "");

        // Medicamento (com classe para destacar)
        const td0 = document.createElement("td");
        td0.textContent = medicamento;
        td0.className = "col-medicamento";
        tr.appendChild(td0);

        // Escala
        const td1 = document.createElement("td");
        td1.textContent = escala;
        tr.appendChild(td1);

        // Potências
        const td2 = document.createElement("td");
        td2.textContent = potencias;
        tr.appendChild(td2);

        tbody.appendChild(tr);
      });

      // DataTables
      const dt = $('#tabela').DataTable({
        pageLength: 100,
        lengthMenu: [10, 25, 50, 100],
        order: [],
        language: {
          decimal: ",",
          thousands: ".",
          processing: "Processando...",
          search: "Buscar medicamento:",
          lengthMenu: "Mostrar _MENU_ registros",
          info: "Mostrando de _START_ até _END_ de _TOTAL_ registros",
          infoEmpty: "Mostrando 0 até 0 de 0 registros",
          infoFiltered: "(filtrado de _MAX_ registros no total)",
          loadingRecords: "Carregando...",
          zeroRecords: "Nenhum medicamento encontrado",
          emptyTable: "Nenhum dado disponível na tabela",
          paginate: {
            first: "Primeiro",
            previous: "Anterior",
            next: "Próximo",
            last: "Último"
          },
          aria: {
            sortAscending: ": ativar para ordenar a coluna em ordem crescente",
            sortDescending: ": ativar para ordenar a coluna em ordem decrescente"
          }
        }
      });

      // Ajuste: quando alguém digitar, forçamos a busca priorizando a 1ª coluna (Medicamento),
      // para ficar coerente com a intenção do usuário.
      // (A busca geral do DataTables continua existindo, mas aqui “focamos” no medicamento.)
      const $input = $('div.dataTables_filter input');
      $input.off('keyup.DT input.DT'); // remove handler padrão
      $input.on('input', function () {
        const q = this.value || "";
        dt.columns().search("");         // limpa buscas por coluna (se houver)
        dt.column(0).search(q).draw();   // busca só no Medicamento
      });

      document.getElementById("status").textContent = "";
    }

    function carregarCSV() {
      Papa.parse(ARQUIVO_CSV, {
        download: true,
        header: false,
        skipEmptyLines: false,
        delimiter: DELIMITADOR,
        complete: function(results) {
          if (!results || !results.data || results.data.length === 0) {
            document.getElementById("status").innerHTML =
              '<div class="erro">Não foi possível ler o CSV. Verifique se o arquivo <b>dados.csv</b> está na mesma pasta do <b>index.html</b>.</div>';
            return;
          }

          // 1ª linha como cabeçalho
          let cabecalho = results.data[0] || [];
          let linhas = results.data.slice(1);

          // Se o cabeçalho veio vazio/estranho, usa padrão e trata tudo como linha
          const cabecalhoValido = cabecalho.length >= 3 && cabecalho.some(x => String(x ?? "").trim() !== "");
          if (!cabecalhoValido) {
            cabecalho = CABECALHO_PADRAO;
            linhas = results.data;
          }

          // Garante 3 colunas no cabeçalho
          cabecalho = [
            (cabecalho[0] ?? CABECALHO_PADRAO[0]).toString(),
            (cabecalho[1] ?? CABECALHO_PADRAO[1]).toString(),
            (cabecalho[2] ?? CABECALHO_PADRAO[2]).toString()
          ];

          montarTabela(cabecalho, linhas);
        },
        error: function(err) {
          document.getElementById("status").innerHTML =
            '<div class="erro">Erro ao carregar o CSV: ' + (err?.message || err) + '</div>';
        }
      });
    }

    carregarCSV();
  </script>
</body>
</html>